<div class="container-fluid">
  <h2 class="mb-4">üë• Gesti√≥n de Empleados</h2>

  <!-- Pesta√±as -->
  <ul class="nav nav-tabs mb-3">
    <li class="nav-item">
      <button class="nav-link" [class.active]="activeTab === 'form'" (click)="setTab('form')">
        ‚ûï {{ editingId ? 'Editar' : 'Crear' }} Empleado
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" [class.active]="activeTab === 'list'" (click)="setTab('list')">
        üìã Listado
      </button>
    </li>
  </ul>

  <!-- TAB: Formulario -->
  @if (activeTab === 'form') {
    <form [formGroup]="employeeForm" (ngSubmit)="submitForm()" class="card p-3 mb-4 shadow-sm">
      <h5 class="card-title">{{ editingId ? 'Editar Empleado' : 'Crear Nuevo Empleado' }}</h5>
      <br>
      <!-- Secci√≥n: Datos Personales -->
      <div class="row mb-4">
        <div class="col-12">
          <h6 class="border-bottom pb-2">üë§ Datos Personales</h6>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Nombre *</label>
          <input formControlName="firstName" class="form-control" />
          @if (employeeForm.get('firstName')?.invalid && employeeForm.get('firstName')?.touched) {
            <small class="text-danger">Nombre es requerido</small>
          }
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Apellidos *</label>
          <input formControlName="lastName" class="form-control" />
          @if (employeeForm.get('lastName')?.invalid && employeeForm.get('lastName')?.touched) {
            <small class="text-danger">Apellidos son requeridos</small>
          }
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Fecha de Nacimiento</label>
          <input type="date" formControlName="dateOfBirth" class="form-control" />
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">G√©nero</label>
          <select formControlName="gender" class="form-select">
            <option value="">Seleccionar...</option>
            @for (gender of genders; track gender) {
              <option [value]="gender">{{ gender }}</option>
            }
          </select>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Estado Civil</label>
          <select formControlName="maritalStatus" class="form-select">
            <option value="">Seleccionar...</option>
            @for (status of maritalStatuses; track status) {
              <option [value]="status">{{ status }}</option>
            }
          </select>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Email Personal</label>
          <input type="email" formControlName="emailPersonal" class="form-control" />
          @if (employeeForm.get('emailPersonal')?.invalid && employeeForm.get('emailPersonal')?.touched) {
            <small class="text-danger">Email no v√°lido</small>
          }
        </div>
      </div>

      <!-- Secci√≥n: Documentaci√≥n -->
      <div class="row mb-4">
        <div class="col-12">
          <h6 class="border-bottom pb-2">üìÑ Documentaci√≥n</h6>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">DNI *</label>
          <input formControlName="dni" class="form-control" placeholder="12345678A" />
          @if (employeeForm.get('dni')?.invalid && employeeForm.get('dni')?.touched) {
            <small class="text-danger">DNI es requerido y debe tener formato 12345678A</small>
          }
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">N¬∫ Seguridad Social *</label>
          <input formControlName="healthInsuranceNumber" class="form-control" />
          @if (employeeForm.get('healthInsuranceNumber')?.invalid && employeeForm.get('healthInsuranceNumber')?.touched) {
            <small class="text-danger">NSS es requerido</small>
          }
        </div>
      </div>

      <!-- Secci√≥n: Datos de Contacto -->
      <div class="row mb-4">
        <div class="col-12">
          <h6 class="border-bottom pb-2">üìû Datos de Contacto</h6>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">Direcci√≥n</label>
          <input formControlName="address" class="form-control" />
        </div>

        <div class="col-md-3 mb-3">
          <label class="form-label">Ciudad</label>
          <input formControlName="city" class="form-control" />
        </div>

        <div class="col-md-3 mb-3">
          <label class="form-label">Pa√≠s</label>
          <input formControlName="country" class="form-control" />
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">Tel√©fono</label>
          <input type="tel" formControlName="phone" class="form-control" />
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">Contacto de Emergencia</label>
          <input formControlName="emergencyContact" class="form-control" />
        </div>
      </div>

      <!-- Secci√≥n: Datos Laborales -->
      <div class="row mb-4">
        <div class="col-12">
          <h6 class="border-bottom pb-2">üíº Datos Laborales</h6>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Puesto *</label>
          <input formControlName="position" class="form-control" />
          @if (employeeForm.get('position')?.invalid && employeeForm.get('position')?.touched) {
            <small class="text-danger">Puesto es requerido</small>
          }
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Nivel del Puesto</label>
          <select formControlName="jobLevel" class="form-select">
            <option value="">Seleccionar...</option>
            @for (level of jobLevels; track level) {
              <option [value]="level">{{ level }}</option>
            }
          </select>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Tipo de Contrato</label>
          <select formControlName="contractType" class="form-select">
            <option value="">Seleccionar...</option>
            @for (contract of contractTypes; track contract) {
              <option [value]="contract">{{ contract }}</option>
            }
          </select>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Fecha de Alta *</label>
          <input type="date" formControlName="hireDate" class="form-control" />
          @if (employeeForm.get('hireDate')?.invalid && employeeForm.get('hireDate')?.touched) {
            <small class="text-danger">Fecha de alta es requerida</small>
          }
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Fecha de Baja</label>
          <input type="date" formControlName="fireDate" class="form-control" />
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Fecha Fin Contrato</label>
          <input type="date" formControlName="contractExpireDate" class="form-control" />
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Horario de Trabajo</label>
          <select formControlName="workSchedule" class="form-select">
            <option value="">Seleccionar...</option>
            @for (schedule of workSchedules; track schedule) {
              <option [value]="schedule">{{ schedule }}</option>
            }
          </select>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Departamento</label>
          @if (!departments || departments.length === 0) {
            <input formControlName="department" class="form-control" placeholder="Departamento" />
          }@else {
            <select formControlName="department" class="form-select">
              <option value="">Seleccionar...</option>
              @for (dept of departments; track dept) {
                <option [value]="dept">{{ dept }}</option>
              }
            </select>
          }
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Antig√ºedad</label>
          <input formControlName="seniority" class="form-control" placeholder="Ej: 2 a√±os" />
        </div>
      </div>

      <!-- Secci√≥n: Vacaciones -->
      <div class="row mb-4">
        <div class="col-12">
          <h6 class="border-bottom pb-2">üèñÔ∏è Vacaciones</h6>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">D√≠as Asignados</label>
          <input type="number" formControlName="vacationsDaysAllocated" class="form-control" min="0" />
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">D√≠as Usados</label>
          <input type="number" formControlName="vacationsDaysUsed" class="form-control" min="0" />
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">D√≠as Restantes</label>
          <input type="number" [value]="getRemainingVacationDays()" class="form-control" readonly />
        </div>
      </div>

      <!-- Secci√≥n: Datos Bancarios -->
      <div class="row mb-4">
        <div class="col-12">
          <h6 class="border-bottom pb-2">üè¶ Datos Bancarios</h6>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">Banco</label>
          <input formControlName="bankName" class="form-control" />
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">IBAN</label>
          <input formControlName="iban" class="form-control" placeholder="ES9121000418450200051332" />
          @if (employeeForm.get('iban')?.invalid && employeeForm.get('iban')?.touched) {
            <small class="text-danger">Formato de IBAN no v√°lido</small>
          }
        </div>
      </div>

      <!-- Secci√≥n: Estado -->
      <div class="row mb-4">
        <div class="col-12">
          <h6 class="border-bottom pb-2">üìä Estado</h6>
        </div>

        <div class="col-md-12 mb-3">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" formControlName="active" id="activeSwitch">
            <label class="form-check-label" for="activeSwitch">
              Empleado Activo
            </label>
          </div>
        </div>
      </div>

      <!-- Botones -->
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="employeeForm.invalid"
          >
            {{ editingId ? 'Actualizar' : 'Crear' }} Empleado
          </button>
          <button type="button" class="btn btn-secondary ms-2" (click)="setTab('list')">
            Cancelar
          </button>
        </div>

        @if (editingId) {
          <div class="text-muted">
            Editando empleado ID: {{ editingId }}
          </div>
        }
      </div>
    </form>
  }

  <!-- TAB: Listado -->
  @if (activeTab === 'list') {
    <div>
      <!-- Barra de b√∫squeda -->
      <div class="d-flex mb-3">
        <input
          type="text"
          class="form-control form-control-sm me-2"
          placeholder="üîç Buscar por DNI, Nombre, Apellido o Puesto"
          [(ngModel)]="searchText"
          (input)="filterEmployees()"
        />
        <button class="btn btn-outline-secondary btn-sm" (click)="clearSearch()">Limpiar</button>
      </div>

      <!-- Tabla empleados -->
      <div class="table-responsive">
        <table class="table table-striped table-hover shadow-sm">
          <thead class="table-light">
            <tr>
              <th>DNI</th>
              <th>Nombre</th>
              <th>Apellidos</th>
              <th>Puesto</th>
              <th>Tel√©fono</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for (emp of filteredEmployees; track emp.id) {
              <tr>
                <td>{{ emp.dni }}</td>
                <td>{{ emp.firstName }}</td>
                <td>{{ emp.lastName }}</td>
                <td>{{ emp.position }}</td>
                <td>{{ emp.phone }}</td>
                <td>
                  <span class="badge" [class.bg-success]="emp.active" [class.bg-secondary]="!emp.active">
                    {{ emp.active ? 'Activo' : 'Inactivo' }}
                  </span>
                </td>
                <td>
                  <button class="btn btn-warning btn-sm me-1" (click)="editEmployee(emp)">
                    ‚úèÔ∏è Editar
                  </button>
                  <button class="btn btn-danger btn-sm" (click)="deleteEmployee(emp.id!)">
                    üóëÔ∏è Eliminar
                  </button>
                </td>
              </tr>
            }
            @if (filteredEmployees.length === 0) {
              <tr>
                <td colspan="7" class="text-center text-muted">
                  No se encontraron empleados
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  }
</div>
